(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[325],{5098:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return AudioBanner}});var n=a(7437),r=a(2265),i=a(9656),o=a(8910),l=a(1951),u=a(7052),s=a(1906);function prettyPrintTimestamp(e){let t=Math.floor(e),a=Math.floor(t/60),n=t%60,r="".concat(n<10?"0":"").concat(n),i="".concat(a<10?"0":"").concat(a);return"".concat(i,":").concat(r)}a(2278);let c=[.25,.5,.75,1,1.25,1.5,1.75];function GlobalAudioPlayer(e){var t;let{labelledBy:a,modalMode:i,manualStopHandler:s}=e,[d,p]=(0,r.useState)(!1),[m,f]=(0,r.useState)(1),[h,y]=(0,r.useState)(!1),[b,x]=(0,r.useState)(0),[_,v]=(0,r.useState)(0),g=(0,r.useRef)(null),j=(0,r.useRef)(null),k=(0,r.useRef)(null),w=(0,r.useRef)(null),E=(0,r.useRef)(null),S=(0,r.useRef)(!1),A=(0,r.useRef)(!1),N=(0,r.useRef)(null),T=(0,r.useRef)(null),{t:L}=(0,l.Q)(),{currentAudioData:C,audioPlaybackState:I,setAudioElementRef:D,setAudioStatus:P,audioElement:R}=(0,u.YC)(),O=I===u.AudioStatus.playing,M="".concat(h?L("audio.restart_audio_aria"):L("inputs.".concat(O?"pause":"play","_audio_aria"))," ").concat(C.title),z=prettyPrintTimestamp(b),B=prettyPrintTimestamp(_),G=(0,r.useCallback)(e=>{let t=e.target,a=![k,w].some(e=>{let{current:a}=e;return a.contains(t)});a&&p(!1)},[]);return E.current=G,(0,r.useEffect)(()=>{let e=j.current;if(!R)return;let handleAudioMetaLoaded=()=>{e.max=R.duration.toString(),v(R.duration)},handleAudioTimeUpdate=()=>{e.value=R.currentTime.toString(),x(R.currentTime)},updateAudioPosition=()=>{R.currentTime=Number(e.value)};return R.readyState>=1?handleAudioMetaLoaded():R.addEventListener("loadedmetadata",handleAudioMetaLoaded),R.addEventListener("timeupdate",handleAudioTimeUpdate),e.addEventListener("input",updateAudioPosition),()=>{R.removeEventListener("loadedmetadata",handleAudioMetaLoaded),R.removeEventListener("timeupdate",handleAudioTimeUpdate),e.removeEventListener("input",updateAudioPosition)}},[R]),(0,r.useEffect)(()=>{i||R===g.current||D(g.current)},[D,R,i]),(0,r.useEffect)(()=>{if(R&&N.current!==C.snippetId){var e;N.current=C.snippetId,R.src=null!==(e=C.src)&&void 0!==e?e:"",A.current=!1,R.load()}},[R,C]),(0,r.useEffect)(()=>{R&&(T.current&&(clearTimeout(T.current),T.current=null),I===u.AudioStatus.playing?(R.currentTime===R.duration&&(R.currentTime=0),A.current&&R.play()):I===u.AudioStatus.paused?R.pause():I===u.AudioStatus.stopped?(R.pause(),R.currentTime=0):I===u.AudioStatus.complete&&(T.current=setTimeout(()=>{P(u.AudioStatus.stopped,C.snippetId)},3e3)))},[R,I,P,C]),(0,r.useEffect)(()=>{let unregisterDocumentClickawayListener=()=>{S.current&&(document.removeEventListener("mousedown",E.current),S.current=!1)};return d?S.current||(document.addEventListener("mousedown",E.current),S.current=!0):unregisterDocumentClickawayListener(),()=>{unregisterDocumentClickawayListener()}},[d]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 text-2xl w-full text-amber-900 dark:text-orange-300",children:[(0,n.jsx)("button",{onClick:()=>{let e=O?u.AudioStatus.paused:u.AudioStatus.playing;P(e,C.snippetId),y(!1)},onKeyDown:e=>{[" ","Enter"].includes(e.key)&&(e.preventDefault(),P(u.AudioStatus.paused,C.snippetId),y(!1))},"aria-label":M,title:M,className:"h-10 w-10 flex items-center justify-center shrink-0","data-testid":"audio-player-play-button",children:O?(0,n.jsx)(o.SUn,{"aria-hidden":"true"}):h?(0,n.jsx)(o.zq9,{"aria-hidden":"true"}):(0,n.jsx)(o.Hm_,{"aria-hidden":"true"})}),(0,n.jsx)("code",{className:"text-xs",title:"".concat(L("audio.audio_time_elapsed_title")," ").concat(C.title),children:z}),(0,n.jsx)("input",{ref:j,type:"range",min:"0",step:"0.1",defaultValue:0,"aria-label":"".concat(L("audio.audio_scrubber_aria")," ").concat(C.title),className:"c-audio-player__scrubber"}),(0,n.jsx)("code",{className:"text-xs",title:"".concat(L("audio.audio_time_total_title")," ").concat(C.title),children:B}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("button",{ref:w,"aria-label":"".concat(L("audio.change_playback_speed_aria")," ").concat(C.title),title:"".concat(L("audio.change_playback_speed_aria")," ").concat(C.title),"data-testid":"audio-player-speed-button",onClick:()=>p(!d),onKeyDown:e=>{[" ","Enter"].includes(e.key)&&(e.preventDefault(),p(!d))},className:"h-10 w-10 flex items-center justify-center shrink-0",children:(0,n.jsx)(o.JKp,{"aria-hidden":"true"})}),(0,n.jsx)("ul",{ref:k,role:"menu",className:"".concat(i?"-top-60":""," absolute -left-12 p-3 bg-amber-50 shadow-lg rounded-sm border-[1px] border-amber-900 dark:bg-stone-950 dark:border-orange-300"),hidden:!d,"aria-hidden":!d,"aria-label":"".concat(L("audio.audio_speed_menu_label")," ").concat(C.title),"data-testid":"audio-player-speed-menu",onKeyDown:e=>{"Escape"===e.key&&p(!1)},children:c.map((e,t)=>(0,n.jsx)("li",{role:"menuitemradio","aria-checked":m===e,tabIndex:0,"aria-label":"".concat(L("audio.audio_speed_item_label")," ").concat(e),className:"".concat(m===e?"font-bold":""," text-sm cursor-pointer my-2 hover:underline"),"data-testid":"audio-player-speed-option-".concat(t),onClick:()=>{R&&(R.playbackRate=e),f(e),p(!1)},onKeyDown:t=>{[" ","Enter"].includes(t.key)&&(t.preventDefault(),R&&(R.playbackRate=e),f(e),p(!1))},children:1===e?L("global.normal"):"".concat(e,"x")},"audio-speed-label-".concat(a,"-").concat(t)))})]}),(0,n.jsx)("button",{onClick:()=>{P(u.AudioStatus.stopped,C.snippetId),y(!1),null==s||s()},onKeyDown:e=>{[" ","Enter"].includes(e.key)&&(e.preventDefault(),P(u.AudioStatus.stopped,C.snippetId),y(!1),null==s||s())},"aria-label":"".concat(L("audio.stop_audio_aria")," ").concat(C.title),title:"".concat(L("audio.stop_audio_aria")," ").concat(C.title),className:"h-10 w-10 flex items-center justify-center shrink-0","data-testid":"audio-player-stop-button",children:(0,n.jsx)(o.YG8,{"aria-hidden":"true"})})]}),!i&&(0,n.jsx)("audio",{ref:g,controls:!0,src:null!==(t=C.src)&&void 0!==t?t:void 0,"aria-labelledby":a,hidden:!0,"data-testid":"audio-player-audio-element",onEnded:()=>{P(u.AudioStatus.complete,C.snippetId),y(!0)},onLoadStart:()=>{A.current=!1},onLoadedMetadata:()=>{A.current=!0,O&&(null==R||R.play())}})]})}let d=(0,r.lazy)(()=>a.e(804).then(a.bind(a,3804)));function AudioBanner(){var e,t;let[a,c]=(0,r.useState)(!1),[p,m]=(0,r.useState)(!0),[f,h]=(0,r.useState)(!1),[y,b]=(0,r.useState)(!1),x=(0,r.useRef)(0),_=(0,r.useRef)(null),{t:v}=(0,l.Q)(),{audioPlaybackState:g,currentAudioData:j}=(0,u.YC)(),k=(0,n.jsxs)("div",{className:"flex gap-2 items-center justify-center cursor-pointer text-amber-900 dark:text-orange-300",children:[(0,n.jsx)(o.Q7r,{"aria-hidden":!0}),(0,n.jsx)(i.U,{className:"text-xs",children:v("audio.view_transcript_md")})]}),w=(0,r.useCallback)(()=>{h(!0),_.current||(_.current=setTimeout(()=>{m(!0),_.current=null},500))},[]),E=(0,n.jsx)("div",{className:"w-max m-auto min-w-0",children:(0,n.jsx)(GlobalAudioPlayer,{labelledBy:"audio-banner-title",modalMode:!0,manualStopHandler:w})});return(0,r.useEffect)(()=>{let e=(0,s.Z)(()=>{let e=window.scrollY||document.documentElement.scrollTop,t=e>x.current;x.current=e,t&&a?w():_.current&&(clearTimeout(_.current),_.current=null)},100);return e(),document.addEventListener("scroll",e),()=>{document.removeEventListener("scroll",e),_.current&&(clearTimeout(_.current),_.current=null)}},[a,w]),(0,r.useEffect)(()=>{g!==u.AudioStatus.stopped&&(h(!1),m(!1),b(!0)),c(g===u.AudioStatus.stopped)},[g]),(0,n.jsxs)("div",{role:"region",className:"".concat(f?"-top-40":"top-0"," ").concat(p?"hidden":"flex"," fixed right-0 left-0 h-fit py-2 px-4 bg-amber-50 shadow-sm z-50 items-center justify-center flex-col transition-all duration-300 dark:bg-stone-950"),"aria-hidden":p,"aria-label":v("audio.audio_banner_aria"),children:[(0,n.jsx)("h3",{id:"audio-banner-title",className:"font-header text-sm dark:text-white",children:j.title}),(0,n.jsx)("div",{className:"max-w-lg m-auto",children:(0,n.jsx)(GlobalAudioPlayer,{labelledBy:"audio-banner-title",modalMode:!1,manualStopHandler:w})}),(0,n.jsx)(r.Suspense,{fallback:null,children:y&&(0,n.jsx)(d,{trigger:k,description:"".concat(v("audio.open_transcript_modal")," ").concat(j.title),title:null!==(e=j.title)&&void 0!==e?e:"",subtitle:v("audio.audio_transcript"),footer:E,children:(0,n.jsx)(i.U,{children:null!==(t=j.transcript)&&void 0!==t?t:""})})})]})}},1906:function(e,t,a){"use strict";function throttle(e,t){let a=0,n=null;return function(){for(var r=arguments.length,i=Array(r),o=0;o<r;o++)i[o]=arguments[o];let l=Date.now();!a||l-a>=t?(a=l,e.apply(this,i)):(n&&clearTimeout(n),n=setTimeout(()=>{a=l,e.apply(this,i)},t-(l-a)))}}a.d(t,{Z:function(){return throttle}})},2278:function(){},1172:function(e,t,a){"use strict";a.d(t,{w_:function(){return GenIcon}});var n=a(2265),r={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},i=n.createContext&&n.createContext(r),__assign=function(){return(__assign=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},__rest=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)0>t.indexOf(n[r])&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]]);return a};function Tree2Element(e){return e&&e.map(function(e,t){return n.createElement(e.tag,__assign({key:t},e.attr),Tree2Element(e.child))})}function GenIcon(e){return function(t){return n.createElement(IconBase,__assign({attr:__assign({},e.attr)},t),Tree2Element(e.child))}}function IconBase(e){var elem=function(t){var a,r=e.attr,i=e.size,o=e.title,l=__rest(e,["attr","size","title"]),u=i||t.size||"1em";return t.className&&(a=t.className),e.className&&(a=(a?a+" ":"")+e.className),n.createElement("svg",__assign({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,r,l,{className:a,style:__assign(__assign({color:e.color||t.color},t.style),e.style),height:u,width:u,xmlns:"http://www.w3.org/2000/svg"}),o&&n.createElement("title",null,o),e.children)};return void 0!==i?n.createElement(i.Consumer,null,function(e){return elem(e)}):elem(r)}}}]);